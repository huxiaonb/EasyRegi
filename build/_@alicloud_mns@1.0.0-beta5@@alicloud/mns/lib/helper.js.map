{"version":3,"sources":["_@alicloud_mns@1.0.0-beta5@@alicloud/mns/lib/helper.js"],"names":["xml2js","require","exports","parseXML","input","resolve","reject","parseString","err","obj","extract","arr","length","forEach","item","key","format","params","xml","value","toXMLBuffer","entityType","subType","Array","isArray","Buffer","from","getEndpoint","accountid","opts","protocol","secure","region","internal","vpc","endpoint","domain","getCanonicalizedMNSHeaders","headers","filter","startsWith","sort","map","join","getResponseHeaders","attentions","result"],"mappings":"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","file":"_@alicloud_mns@1.0.0-beta5@@alicloud/mns/lib/helper.js","sourcesContent":["'use strict';\n\nconst xml2js = require('xml2js');\n\nexports.parseXML = function (input) {\n  return new Promise((resolve, reject) => {\n    xml2js.parseString(input, (err, obj) => {\n      if (err) {\n        return reject(err);\n      }\n      resolve(obj);\n    });\n  });\n};\n\nexports.extract = function extract (arr) {\n  if (arr && arr.length === 1 && typeof arr[0] === 'string') {\n    return arr[0];\n  }\n\n  arr.forEach((item) => {\n    Object.keys(item).forEach((key) => {\n      item[key] = extract(item[key]);\n    });\n  });\n\n  return arr;\n};\n\nfunction format (params) {\n  var xml = '';\n  Object.keys(params).forEach((key) => {\n    const value = params[key];\n    if (typeof value === 'object') {\n      xml +=    `<${key}>${format(value)}</${key}>`;\n    } else {\n      xml +=    `<${key}>${value}</${key}>`;\n    }\n  });\n  return xml;\n}\n\nexports.toXMLBuffer = function (entityType, params, subType) {\n  var xml = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>';\n  xml +=    `<${entityType} xmlns=\"http://mns.aliyuncs.com/doc/v1/\">`;\n  if (Array.isArray(params)) {\n    params.forEach((item) => {\n      xml +=  `<${subType}>`;\n      xml += format(item);\n      xml +=  `</${subType}>`;\n    });\n  } else {\n    xml +=    format(params);\n  }\n  xml +=    `</${entityType}>`;\n  return Buffer.from(xml, 'utf8');\n};\n\n// http(s)://{AccountId}.mns.cn-beijing.aliyuncs.com\n// http://{AccountId}.mns.cn-beijing-internal.aliyuncs.com\n// http://{AccountId}.mns.cn-beijing-internal-vpc.aliyuncs.com\n\nexports.getEndpoint = function (accountid, opts) {\n  const protocol = opts.secure ? 'https' : 'http';\n  let region = `${opts.region}`;\n  if (opts.internal) {\n    region += '-internal';\n  }\n\n  if (opts.vpc) {\n    region += '-vpc';\n  }\n\n  return {\n    endpoint: `${protocol}://${accountid}.mns.${region}.aliyuncs.com`,\n    domain: `${accountid}.mns.${region}.aliyuncs.com`\n  };\n};\n\nexports.getCanonicalizedMNSHeaders = function (headers) {\n  return Object.keys(headers)\n    .filter((key) => key.startsWith('x-mns-'))\n    .sort()\n    .map((key) => `${key}:${headers[key]}\\n`)\n    .join('');\n};\n\nexports.getResponseHeaders = function (headers, attentions) {\n  var result = {};\n  attentions.forEach((key) => {\n    result[key] = headers[key];\n  });\n  return result;\n};\n"],"sourceRoot":"/source/"}